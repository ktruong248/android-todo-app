package com.example.ktruong.todoapp;import android.app.Activity;import android.content.Intent;import android.os.Bundle;import android.view.Menu;import android.view.MenuItem;import android.view.View;import android.widget.AdapterView;import android.widget.ArrayAdapter;import android.widget.EditText;import android.widget.ListView;import android.widget.Toast;import com.example.ktruong.todoapp.entities.TodoItem;import com.example.ktruong.todoapp.repositories.TodoItemRepository;import com.example.ktruong.todoapp.repositories.TodoItemRepositoryImpl;import java.util.ArrayList;import java.util.List;import static com.example.ktruong.todoapp.utils.StringUtils.isNotEmpty;public class MainActivity extends Activity {    public static int EDIT_INTENT_RETURN_CODE = 200;    private ListView lvItems;    private List<TodoItemView> todoItemViewList;    private ArrayAdapter<TodoItemView> itemsAdapter;    private TodoItemRepository todoItemRepository;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_main);        todoItemRepository = new TodoItemRepositoryImpl(this);        List<TodoItem> todoItems = todoItemRepository.getAll();        todoItemViewList = new ArrayList();        if(todoItems != null) {            for (TodoItem todoItem : todoItems) {                todoItemViewList.add(new TodoItemView(todoItem));            }        }        lvItems = (ListView) findViewById(R.id.lvItems);        itemsAdapter = new ArrayAdapter(this, android.R.layout.simple_list_item_1, todoItemViewList);        lvItems.setAdapter(itemsAdapter);        setupListViewListener();    }    /**     *     */    private void setupListViewListener() {        lvItems.setOnItemLongClickListener(new AdapterView.OnItemLongClickListener() {            @Override            public boolean onItemLongClick(AdapterView<?> parent, View view, int position, long id) {                TodoItemView removed = todoItemViewList.remove(position);                itemsAdapter.notifyDataSetChanged();                todoItemRepository.delete(removed.getTodoItem());                return true;            }        });        /**         * todo convert to Request implement Serializable object and use User u = (User) getIntent().getSerializableExtra("user");         */        lvItems.setOnItemClickListener(new AdapterView.OnItemClickListener() {            @Override            public void onItemClick(AdapterView<?> parent, View view, int position, long id) {                TodoItemView todoItemView = todoItemViewList.get(position);                Intent editIntent = new Intent(MainActivity.this, EditItemActivity.class);                editIntent.putExtra("todo_item_id", todoItemView.getTodoItem().getId());                editIntent.putExtra("todo_item_body", todoItemView.getTodoItem().getBody());                startActivityForResult(editIntent, EDIT_INTENT_RETURN_CODE);            }        });    }    @Override    public boolean onCreateOptionsMenu(Menu menu) {        // Inflate the menu; this adds todoItemViewList to the action bar if it is present.        getMenuInflater().inflate(R.menu.menu_main, menu);        return true;    }    @Override    public boolean onOptionsItemSelected(MenuItem item) {        // Handle action bar item clicks here. The action bar will        // automatically handle clicks on the Home/Up button, so long        // as you specify a parent activity in AndroidManifest.xml.        int id = item.getItemId();        System.out.println("item " + id + "selected " + item.getTitle());        //noinspection SimplifiableIfStatement        if (id == R.id.action_settings) {            return true;        }        return super.onOptionsItemSelected(item);    }    public void onAddItem(View v) {        EditText etNewItem = (EditText) findViewById(R.id.etNewItem);        String itemText = etNewItem.getText().toString();        if (isNotEmpty(itemText)) {            TodoItem newItem = new TodoItem(null, itemText, 0);            itemsAdapter.add(new TodoItemView(newItem));            etNewItem.setText("");            todoItemRepository.addItem(newItem);        }    }    @Override    protected void onActivityResult(int requestCode, int resultCode, Intent data) {        // REQUEST_CODE is defined above        if (resultCode == EDIT_INTENT_RETURN_CODE ) {            // call from MainActivity to detect the intent            int todoItemId = data.getIntExtra("todo_item_id", -1);            String modifiedText = data.getStringExtra("todo_item_body_modified");            System.out.println("onActivityResult MainActivity intent id " + todoItemId + " modified text " + modifiedText + " from request code " + requestCode);            if(todoItemViewList != null) {                for (TodoItemView todoItemView : todoItemViewList) {                    if(todoItemView.getTodoItem().getId() == todoItemId) {                        todoItemView.getTodoItem().setBody(modifiedText);                        break;                    }                }            }            itemsAdapter.notifyDataSetChanged();        }    }}